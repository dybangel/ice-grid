2019-07-30 11:38:21.114:Query=select * from (select productID,(select bh from asm_product p where p.productID=A.productID) bh, (SELECT STUFF((SELECT ','+ldNO FROM  asm_ldinfo where productID=A.productID and mechineID in(25,29,40,44,67) for xml path('')),1,1,'')  ldno) ldno,(select proname from asm_product p where p.productID=A.productID) proname,(select progg from asm_product p where p.productID=A.productID) progg, (select sluid from asm_product p where p.productID = A.productID) sluid, (select brandName from  asm_brand where id in(select brandID from asm_product where productID = A.productID))  brandName,sum(dgNum)dgNum,sum(lsNum)lsNum,sum(totalLsNum)totalLsNum,sum(imbalance)imbalance,sum(totalDgNum)totalDgNum,sum(totalDG)totalDG from ( SELECT *, isnull((select COUNT(*) totalDgNum from asm_orderlistDetail o where zt != 8 and o.productID = k.productID and createTime >= '2019-07-29'and createTime <= '2019-07-30' and mechineID=25 group by productID),0) as totalDG FROM asm_kcDetail k WHERE(id IN(SELECT MAX([id])   FROM asm_kcDetail  where  mechineID = 25 and dateTime<'2019-07-30 11:37:04' and imbalance>=0 and productID in (353,381) group by productID))  union SELECT *, isnull((select COUNT(*) totalDgNum from asm_orderlistDetail o where zt != 8 and o.productID = k.productID and createTime >= '2019-07-29'and createTime <= '2019-07-30' and mechineID=29 group by productID),0) as totalDG FROM asm_kcDetail k WHERE(id IN(SELECT MAX([id])   FROM asm_kcDetail  where  mechineID = 29 and dateTime<'2019-07-30 11:37:04' and imbalance>=0 and productID in () group by productID))  union SELECT *, isnull((select COUNT(*) totalDgNum from asm_orderlistDetail o where zt != 8 and o.productID = k.productID and createTime >= '2019-07-29'and createTime <= '2019-07-30' and mechineID=40 group by productID),0) as totalDG FROM asm_kcDetail k WHERE(id IN(SELECT MAX([id])   FROM asm_kcDetail  where  mechineID = 40 and dateTime<'2019-07-30 11:37:04' and imbalance>=0 and productID in (311,315,318,319,324,331,332,333,335,347,348,355,358,390,395,402,412,416,421,430,431,442) group by productID))  union SELECT *, isnull((select COUNT(*) totalDgNum from asm_orderlistDetail o where zt != 8 and o.productID = k.productID and createTime >= '2019-07-29'and createTime <= '2019-07-30' and mechineID=44 group by productID),0) as totalDG FROM asm_kcDetail k WHERE(id IN(SELECT MAX([id])   FROM asm_kcDetail  where  mechineID = 44 and dateTime<'2019-07-30 11:37:04' and imbalance>=0 and productID in (315,315,315,315,315,315,315,315,324,324,324,324,332,333,335,358,358,358,358,358,358,390,409,409,410,410,430,430,430,446) group by productID))  union SELECT *, isnull((select COUNT(*) totalDgNum from asm_orderlistDetail o where zt != 8 and o.productID = k.productID and createTime >= '2019-07-29'and createTime <= '2019-07-30' and mechineID=67 group by productID),0) as totalDG FROM asm_kcDetail k WHERE(id IN(SELECT MAX([id])   FROM asm_kcDetail  where  mechineID = 67 and dateTime<'2019-07-30 11:37:04' and imbalance>=0 and productID in (311,311,315,324,324,335,347,347,358,358,399,400,400,400,401,412,421,424,424,424,427,428,428,429,436,436,436,442,443,443) group by productID))  ) A where productID in (381,353,395,331,355,402,318,319,431,390,324,358,311,416,442,315,412,421,347,348,332,333,335,430,446,410,409,443,400,399,401,427,429,424,436,428) group by productID) B where B.ldno is not null
---------------
2019-07-30 11:38:30.081:Query=select * from (select productID,(select bh from asm_product p where p.productID=A.productID) bh, (SELECT STUFF((SELECT ','+ldNO FROM  asm_ldinfo where productID=A.productID and mechineID in(25,29,40,44,67) for xml path('')),1,1,'')  ldno) ldno,(select proname from asm_product p where p.productID=A.productID) proname,(select progg from asm_product p where p.productID=A.productID) progg, (select sluid from asm_product p where p.productID = A.productID) sluid, (select brandName from  asm_brand where id in(select brandID from asm_product where productID = A.productID))  brandName,sum(dgNum)dgNum,sum(lsNum)lsNum,sum(totalLsNum)totalLsNum,sum(imbalance)imbalance,sum(totalDgNum)totalDgNum,sum(totalDG)totalDG from ( SELECT *, isnull((select COUNT(*) totalDgNum from asm_orderlistDetail o where zt != 8 and o.productID = k.productID and createTime >= '2019-07-29'and createTime <= '2019-07-30' and mechineID=25 group by productID),0) as totalDG FROM asm_kcDetail k WHERE(id IN(SELECT MAX([id])   FROM asm_kcDetail  where  mechineID = 25 and dateTime<'2019-07-30 11:37:04' and imbalance>=0 and productID in (353,381) group by productID))  union SELECT *, isnull((select COUNT(*) totalDgNum from asm_orderlistDetail o where zt != 8 and o.productID = k.productID and createTime >= '2019-07-29'and createTime <= '2019-07-30' and mechineID=29 group by productID),0) as totalDG FROM asm_kcDetail k WHERE(id IN(SELECT MAX([id])   FROM asm_kcDetail  where  mechineID = 29 and dateTime<'2019-07-30 11:37:04' and imbalance>=0 and productID in () group by productID))  union SELECT *, isnull((select COUNT(*) totalDgNum from asm_orderlistDetail o where zt != 8 and o.productID = k.productID and createTime >= '2019-07-29'and createTime <= '2019-07-30' and mechineID=40 group by productID),0) as totalDG FROM asm_kcDetail k WHERE(id IN(SELECT MAX([id])   FROM asm_kcDetail  where  mechineID = 40 and dateTime<'2019-07-30 11:37:04' and imbalance>=0 and productID in (311,315,318,319,324,331,332,333,335,347,348,355,358,390,395,402,412,416,421,430,431,442) group by productID))  union SELECT *, isnull((select COUNT(*) totalDgNum from asm_orderlistDetail o where zt != 8 and o.productID = k.productID and createTime >= '2019-07-29'and createTime <= '2019-07-30' and mechineID=44 group by productID),0) as totalDG FROM asm_kcDetail k WHERE(id IN(SELECT MAX([id])   FROM asm_kcDetail  where  mechineID = 44 and dateTime<'2019-07-30 11:37:04' and imbalance>=0 and productID in (315,315,315,315,315,315,315,315,324,324,324,324,332,333,335,358,358,358,358,358,358,390,409,409,410,410,430,430,430,446) group by productID))  union SELECT *, isnull((select COUNT(*) totalDgNum from asm_orderlistDetail o where zt != 8 and o.productID = k.productID and createTime >= '2019-07-29'and createTime <= '2019-07-30' and mechineID=67 group by productID),0) as totalDG FROM asm_kcDetail k WHERE(id IN(SELECT MAX([id])   FROM asm_kcDetail  where  mechineID = 67 and dateTime<'2019-07-30 11:37:04' and imbalance>=0 and productID in (311,311,315,324,324,335,347,347,358,358,399,400,400,400,401,412,421,424,424,424,427,428,428,429,436,436,436,442,443,443) group by productID))  ) A where productID in (381,353,395,331,355,402,318,319,431,390,324,358,311,416,442,315,412,421,347,348,332,333,335,430,446,410,409,443,400,399,401,427,429,424,436,428,428381) group by productID) B where B.ldno is not null
---------------
2019-07-30 11:38:47.822:Query=select * from (select productID,(select bh from asm_product p where p.productID=A.productID) bh, (SELECT STUFF((SELECT ','+ldNO FROM  asm_ldinfo where productID=A.productID and mechineID in(25,29,40,44,67) for xml path('')),1,1,'')  ldno) ldno,(select proname from asm_product p where p.productID=A.productID) proname,(select progg from asm_product p where p.productID=A.productID) progg, (select sluid from asm_product p where p.productID = A.productID) sluid, (select brandName from  asm_brand where id in(select brandID from asm_product where productID = A.productID))  brandName,sum(dgNum)dgNum,sum(lsNum)lsNum,sum(totalLsNum)totalLsNum,sum(imbalance)imbalance,sum(totalDgNum)totalDgNum,sum(totalDG)totalDG from ( SELECT *, isnull((select COUNT(*) totalDgNum from asm_orderlistDetail o where zt != 8 and o.productID = k.productID and createTime >= '2019-07-30'and createTime <= '2019-07-30' and mechineID=25 group by productID),0) as totalDG FROM asm_kcDetail k WHERE(id IN(SELECT MAX([id])   FROM asm_kcDetail  where  mechineID = 25 and dateTime<'2019-07-30 11:37:04' and imbalance>=0 and productID in (353,381) group by productID))  union SELECT *, isnull((select COUNT(*) totalDgNum from asm_orderlistDetail o where zt != 8 and o.productID = k.productID and createTime >= '2019-07-30'and createTime <= '2019-07-30' and mechineID=29 group by productID),0) as totalDG FROM asm_kcDetail k WHERE(id IN(SELECT MAX([id])   FROM asm_kcDetail  where  mechineID = 29 and dateTime<'2019-07-30 11:37:04' and imbalance>=0 and productID in () group by productID))  union SELECT *, isnull((select COUNT(*) totalDgNum from asm_orderlistDetail o where zt != 8 and o.productID = k.productID and createTime >= '2019-07-30'and createTime <= '2019-07-30' and mechineID=40 group by productID),0) as totalDG FROM asm_kcDetail k WHERE(id IN(SELECT MAX([id])   FROM asm_kcDetail  where  mechineID = 40 and dateTime<'2019-07-30 11:37:04' and imbalance>=0 and productID in (311,315,318,319,324,331,332,333,335,347,348,355,358,390,395,402,412,416,421,430,431,442) group by productID))  union SELECT *, isnull((select COUNT(*) totalDgNum from asm_orderlistDetail o where zt != 8 and o.productID = k.productID and createTime >= '2019-07-30'and createTime <= '2019-07-30' and mechineID=44 group by productID),0) as totalDG FROM asm_kcDetail k WHERE(id IN(SELECT MAX([id])   FROM asm_kcDetail  where  mechineID = 44 and dateTime<'2019-07-30 11:37:04' and imbalance>=0 and productID in (315,315,315,315,315,315,315,315,324,324,324,324,332,333,335,358,358,358,358,358,358,390,409,409,410,410,430,430,430,446) group by productID))  union SELECT *, isnull((select COUNT(*) totalDgNum from asm_orderlistDetail o where zt != 8 and o.productID = k.productID and createTime >= '2019-07-30'and createTime <= '2019-07-30' and mechineID=67 group by productID),0) as totalDG FROM asm_kcDetail k WHERE(id IN(SELECT MAX([id])   FROM asm_kcDetail  where  mechineID = 67 and dateTime<'2019-07-30 11:37:04' and imbalance>=0 and productID in (311,311,315,324,324,335,347,347,358,358,399,400,400,400,401,412,421,424,424,424,427,428,428,429,436,436,436,442,443,443) group by productID))  ) A where productID in (381,353,395,331,355,402,318,319,431,390,324,358,311,416,442,315,412,421,347,348,332,333,335,430,446,410,409,443,400,399,401,427,429,424,436,428,428381) group by productID) B where B.ldno is not null
---------------
