2019-08-22 14:38:08.724:Query=select * from (select productID,(select bh from asm_product p where p.productID=A.productID) bh, (SELECT STUFF((SELECT ','+ldNO FROM  asm_ldinfo where productID=A.productID and mechineID in(44) for xml path('')),1,1,'')  ldno) ldno,(select proname from asm_product p where p.productID=A.productID) proname,(select progg from asm_product p where p.productID=A.productID) progg, (select sluid from asm_product p where p.productID = A.productID) sluid, (select brandName from  asm_brand where id in(select brandID from asm_product where productID = A.productID))  brandName,sum(dgNum)dgNum,sum(lsNum)lsNum,sum(totalLsNum)totalLsNum,sum(imbalance)imbalance,sum(totalDgNum)totalDgNum,sum(totalDG)totalDG from ( SELECT *, isnull((select COUNT(*) totalDgNum from asm_orderlistDetail o where zt != 8 and o.productID = k.productID and createTime >= '2019-08-20'and createTime <= '2019-08-22' and mechineID=44 group by productID),0) as totalDG FROM asm_kcDetail k WHERE(id IN(SELECT MAX([id])   FROM asm_kcDetail  where  mechineID = 44 and dateTime<'2019-08-22 14:32:03' and imbalance>=0 and productID in (311,311,311,315,315,317,317,318,319,319,324,324,324,332,333,335,347,347,348,348,351,358,358,358,390,407,409,410,416,421,421,430,431,439,442,445,446) group by productI) A where productID in (318,430,319,324,358,311,416,442,439,407,431,390,351,315,317,421,347,348,332,333,335,446,445,409,410) group by productID) B where B.ldno is not null
---------------
